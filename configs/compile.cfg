HOST = WIN
RM= del /S /Q /F
RMDIR=rd /S /Q
PWD=cd
MKDIR=mkdir
CD=cd
ECHO=echo
PWD=cd

export HOST RM RMDIR PWD MKDIR CD ECHO PWD
include  $(MKCONF_DIR)/archdef.mk
include  $(MKCONF_DIR)/Cortex-M.mk




BUILD_DIR := build\$(APP)\$(BOARD)

ifneq ($(BUILD_DIR), $(wildcard $(BUILD_DIR)))

$(shell $(MKDIR) $(BUILD_DIR))

endif

BUILD_DIR := $(shell $(CD) $(BUILD_DIR) && $(PWD))
$(if $(BUILD_DIR),,$(error output directory "$(BUILD_DIR)" does not exist))

OBJTREE         := $(BUILD_DIR)
SRCTREE         := $(CURDIR)
TOPDIR          := $(SRCTREE)
LNDIR           := $(OBJTREE)
export  TOPDIR SRCTREE OBJTREE

export MKCONF_DIR := $(addprefix $(TOPDIR)/, $(MKCONF_DIR))

export LIBC_DIR := $(addprefix $(TOPDIR)/, $(LIBC_DIR))

gccincdir := "$(shell $(CC) -print-file-name=include)"
INCPATH = -I. -I$(LIBC_DIR) -I$(LIBC_DIR)/libc_inc  -isystem $(gccincdir)
INCPATH += -nostdinc
INCPATH += -Iinc
CPPFLAGS = $(INCPATH)

ARCH_CFLAGS := -mthumb -Wall -Os -fno-common -mcpu=cortex-m4 -msoft-float
ARCH_LDFLAGS := 
libgccdir :=  "$(shell $(CC) $(ARCH_CFLAGS) -print-file-name=)"


export CFLAGS = $(ARCH_CFLAGS) $(CPPFLAGS)
export ARFLAGS = cr
export LDFLAGS = $(ARCH_LDFLAGS) -nostdlib -static -L$(libgccdir) -lgcc
export AFLAGS = -D__ASSEMBLY__ $(ARCH_CFLAGS) $(CPPFLAGS)

LIBS := $(LIBC_DIR)/libc_Cortex-M4_nofpu.a
LIB_API := $(MKCONF_DIR)/$(BOARD)/NDK_Sysdep_$(BOARD).o

LINKSCRIPT :=  $(MKCONF_DIR)/$(BOARD)/mapp.ld
LDFLAGS += -T$(LINKSCRIPT) --start-group $(LIBS) $(LIBC_DIR)/libemvNDK_POSME31.a  $(LIBC_DIR)/lpub.a $(LIBC_DIR)/libcup.a --end-group
