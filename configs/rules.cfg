$(obj)/%.o:     %.S
	$(CC) $(AFLAGS) -c -o $@ $<
$(obj)/%.o:     %.c
	$(CC) $(CFLAGS) -c -o $@ $<
        

cmd_link_o_target = $(if $(strip $1),\
		      $(LD) $(LINKOFLAGS) -r -o $@ $1,\
		      $(AR) $(ARFLAGS) $@ )
ifndef DEP
DEP = $(CC) -MM $(CPPFLAGS) -MQ
endif

$(obj)\.deps:$(SRCS)
	@if exist $@ (@$(RM) $@)
	@for %%a in ($(SRCS)) do \
                $(DEP) $(obj)/%%~na.o %%a >> $@

ifneq ($(MAKECMDGOALS),clean)
ifneq ($(strip $(OBJS)),)
sinclude $(obj)\.deps
endif
endif